
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.20">
    
    
      
        <title>Lesson13 - Dremig</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.e53b48f4.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../assets/css/extra.css">
    
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lxgw-wenkai-webfont@1.1.0/style.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#concurrency-control" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="Dremig" class="md-header__button md-logo" aria-label="Dremig" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Dremig
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Lesson13
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../.." class="md-tabs__link">
        
  
  
    
  
  首页

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      
  
  
  
  
    
    
      
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../is/ctf/writeups/" class="md-tabs__link">
          
  
  
  信息安全

        </a>
      </li>
    
  

    
  

    
  

      
        
  
  
  
  
    
    
      
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../na/introduce/" class="md-tabs__link">
          
  
  
  课程内容笔记

        </a>
      </li>
    
  

    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../program_language/js/note/" class="md-tabs__link">
          
  
  
  编程语言

        </a>
      </li>
    
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../friend/" class="md-tabs__link">
        
  
  
    
  
  友链

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../about/" class="md-tabs__link">
        
  
  
    
  
  关于

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Dremig" class="md-nav__button md-logo" aria-label="Dremig" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Dremig
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    首页
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    信息安全
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            信息安全
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1" >
        
          
          <label class="md-nav__link" for="__nav_2_1" id="__nav_2_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    CTF
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1">
            <span class="md-nav__icon md-icon"></span>
            CTF
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1_1" >
        
          
          <label class="md-nav__link" for="__nav_2_1_1" id="__nav_2_1_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    writeups
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_1_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1_1">
            <span class="md-nav__icon md-icon"></span>
            writeups
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../is/ctf/writeups/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    about writeups
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../is/ctf/writeups/bhmea2025quals/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    BlackHat MEA CTF 2025 quals
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../is/ctf/writeups/olympics2025quals/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Iran Tech Olympics 2025 quals
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../is/ctf/writeups/qwb2025/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    强网杯 2025 quals
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1_2" >
        
          
          <label class="md-nav__link" for="__nav_2_1_2" id="__nav_2_1_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    review(复盘)
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_1_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1_2">
            <span class="md-nav__icon md-icon"></span>
            review(复盘)
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../is/ctf/review/wmctf2025/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    WMCTF 2025
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    课程内容笔记
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            课程内容笔记
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1" >
        
          
          <label class="md-nav__link" for="__nav_3_1" id="__nav_3_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    数值分析
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_1">
            <span class="md-nav__icon md-icon"></span>
            数值分析
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../na/introduce/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Introduce
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../na/chapter1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Chapter1：Mathematical Preliminaries
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../na/chapter2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Chapter2：Solutions of Equations in One variable
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../na/chapter6/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Chapter6：Direct Methods for Solving Linear Systems
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2" >
        
          
          <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    计算机组成与设计
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            计算机组成与设计
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../co/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Index
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../co/chapter1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Chapter1：计算机概要与技术
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../co/chapter2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Chapter2：计算机的算术运算
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../co/chapter3/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Chapter3：指令：计算机的语言
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../co/chapter4/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Chapter4：处理器
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../co/chapter5/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Chapter5：内存层次架构
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../co/chapter6/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Chapter6：存储与IO
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3" >
        
          
          <label class="md-nav__link" for="__nav_3_3" id="__nav_3_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    普通物理学II(H)
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3">
            <span class="md-nav__icon md-icon"></span>
            普通物理学II(H)
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../physics/introduce/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Introduce
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../physics/chapter32/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Chapter32(33) The Steady Magnetic Field
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../physics/chapter34/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Chapter34 Faraday's Law
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../physics/chapter35/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Chapter35(36)Inductance and Magnetic properties of materials
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../physics/chapter38/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Chapter38 Maxwell Equations
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../physics/chapter39/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Chapter39 EMWave and Light waves
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../physics/chapter40/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Chapter40 Geometrical Optics
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../physics/chapter41/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Chapter41 Interference
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../physics/chapter42/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Chapter42 Diffraction
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../physics/chapter43/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Chapter43 Polarization
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4" >
        
          
          <label class="md-nav__link" for="__nav_3_4" id="__nav_3_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    高级数据结构与算法分析
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_4">
            <span class="md-nav__icon md-icon"></span>
            高级数据结构与算法分析
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ads/introduce/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Introduce
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ads/lesson1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lesson1：AVL树、Splay树与摊还分析
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ads/lesson2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lesson2：红黑树与B+树
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ads/lesson3/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lesson3：倒排索引
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ads/lesson4/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lesson4：左倾堆与倾斜堆
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ads/lesson5/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lesson5：二项队列
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ads/lesson6/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lesson6：回溯法
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ads/lesson7/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lesson7：分治法
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ads/lesson8/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lesson8：动态规划
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ads/lesson9/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lesson9：贪心法
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ads/lesson10/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lesson10：NP问题
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ads/lesson11/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lesson11：近似算法
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ads/lesson12/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lesson12：局部搜索
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ads/lesson13/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lesson13：随机算法
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ads/lesson14/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lesson14：并行算法
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ads/lesson15/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lesson15：外部排序
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_5" >
        
          
          <label class="md-nav__link" for="__nav_3_5" id="__nav_3_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    面向对象程序设计
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_5">
            <span class="md-nav__icon md-icon"></span>
            面向对象程序设计
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../oop/1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lesson1
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../oop/2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lesson2
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_6" >
        
          
          <label class="md-nav__link" for="__nav_3_6" id="__nav_3_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    计算机体系结构
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_6">
            <span class="md-nav__icon md-icon"></span>
            计算机体系结构
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ca/chapter0/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    introduce
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ca/chapter1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Chapter1
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ca/chapter2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Chapter2
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ca/chapter3/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Chapter3
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ca/chapter4/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Chapter4
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ca/chapter5/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Chapter5
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_7" >
        
          
          <label class="md-nav__link" for="__nav_3_7" id="__nav_3_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    机器学习
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_7">
            <span class="md-nav__icon md-icon"></span>
            机器学习
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ml/1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lesson1 Introduce
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ml/2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lesson2 Linear Regression
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ml/4/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lesson4 Discriminant Functions and Classifiers
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ml/5/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lesson5 Kernel Method
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ml/6/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lesson6 Decision Tree
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_8" >
        
          
          <label class="md-nav__link" for="__nav_3_8" id="__nav_3_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    计算机网络
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_8">
            <span class="md-nav__icon md-icon"></span>
            计算机网络
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../web/0.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lesson0
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    编程语言
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            编程语言
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../program_language/js/note/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Javascript
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../program_language/cpp/c%2B%2Bprimer/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    C++
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../friend/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    友链
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../about/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    关于
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#concurrency-control" class="md-nav__link">
    <span class="md-ellipsis">
      Concurrency Control
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Concurrency Control">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#lock-based-protocols" class="md-nav__link">
    <span class="md-ellipsis">
      Lock-Based Protocols
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Lock-Based Protocols">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#the-two-phase-locking-protocol" class="md-nav__link">
    <span class="md-ellipsis">
      The Two-Phase Locking Protocol
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#automatic-acquisition-of-locks" class="md-nav__link">
    <span class="md-ellipsis">
      Automatic Acquisition of Locks
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lock-manager" class="md-nav__link">
    <span class="md-ellipsis">
      lock manager
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#graph-based-protocols" class="md-nav__link">
    <span class="md-ellipsis">
      Graph-based protocols
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      详细解释：
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#timestamp-based-protocols" class="md-nav__link">
    <span class="md-ellipsis">
      *Timestamp-Based Protocols
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#validation-based-protocols" class="md-nav__link">
    <span class="md-ellipsis">
      *Validation-Based Protocols
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#multiple-granularity" class="md-nav__link">
    <span class="md-ellipsis">
      Multiple Granularity
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#multiversion-schemes" class="md-nav__link">
    <span class="md-ellipsis">
      *Multiversion Schemes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deadlock-handling" class="md-nav__link">
    <span class="md-ellipsis">
      Deadlock Handling
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Deadlock Handling">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#deadlock-prevention" class="md-nav__link">
    <span class="md-ellipsis">
      Deadlock Prevention
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deadlock-detection" class="md-nav__link">
    <span class="md-ellipsis">
      Deadlock Detection
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#insert-and-delete-operations" class="md-nav__link">
    <span class="md-ellipsis">
      Insert and Delete Operations
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Insert and Delete Operations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#index-locking-protocol" class="md-nav__link">
    <span class="md-ellipsis">
      Index Locking Protocol
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#concurrency-in-index-structures" class="md-nav__link">
    <span class="md-ellipsis">
      *Concurrency in Index Structures
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



  <h1>Lesson13</h1>

<h2 id="concurrency-control">Concurrency Control</h2>
<h3 id="lock-based-protocols">Lock-Based Protocols</h3>
<p>数据项可以以两种方式lock:
+ X-lock:可以读取也可以写入(独占X模式)
+ S-lock:仅能写入(共享S模式)</p>
<p>此时：
+ 如果一个事务已经对一个数据项持有X-lock，其余事务不能在该数据项上持有任何锁
+ 任意数量的事务可以在同一数据项上持有S-lock
+ 如果一个数据项不能授予一些事务锁，这些事务会等待</p>
<p>锁定协议是所有事务在请求和释放锁时遵循的一组规则。锁定协议通过限制可能的调度集来确保事务的正确执行。</p>
<p>死锁(deadlock)：考虑如下场景：</p>
<pre><code class="language-scss">T3          T4
lock-X(B)
...
           lock-S(A)
           lock-S(B)
lock-X(A)
</code></pre>
<p>这下3/4都不可能执行了，因为如果要lock-S(B)就得等T3结束释放B，但是T3结束之前要lock-X(A)，又得等T4结束释放A，这下谁都commit不了了。</p>
<p>死锁处理：为了处理死锁，必须回滚其中一个事务（T3 或 T4），并释放它所持有的锁。</p>
<p>死锁不可避免地出现，潜在风险出现大多数协议中，同时还有可能导致"饥饿"问题：</p>
<ul>
<li>某个事务想请求独占一个数据项，但是其他事务已经获得了它的共享锁</li>
<li>这个事务就一直回滚</li>
</ul>
<p>并发控制管理器可以通过合理设计来防止饥饿现象。</p>
<h4 id="the-two-phase-locking-protocol">The Two-Phase Locking Protocol</h4>
<p>两阶段锁协议，分为两个阶段：</p>
<ul>
<li>Growing Phase：事务可以获取锁，但不能释放锁</li>
<li>Shrinking Phase: 事务释放掉所有的锁，后续不能再获得任何锁</li>
</ul>
<p>该协议确保可串行化性。可以证明，事务的执行顺序可以按照它们最后获得锁的时刻（即事务获取其最终锁的点）来进行串行化。</p>
<p><strong>两阶段锁定协议并不能确保避免死锁。</strong></p>
<p>在此情况下，可以使用更加严格的方式，即严格两阶段锁定（Strict Two-Phase Locking）：在这个协议中，事务必须一直持有所有锁，直到提交或回滚为止。在此协议下，事务可以按照提交的顺序进行串行化。</p>
<p>即使使用两阶段锁定协议，也可能会有一些冲突可串行化的调度无法被实现。</p>
<p>然而，在没有额外信息（例如，数据访问的顺序）情况下，两阶段锁定对于冲突可串行化是必要的。</p>
<p><img alt="alt text" src="../image-171.png" /></p>
<p>不能，因为进入释放阶段后，又有事务申请了数据项的锁(如T1)。</p>
<h4 id="_1"></h4>
<p>两阶段锁定协议与锁转换：</p>
<ul>
<li>第一阶段：<ul>
<li>可以在数据项上获取共享锁（lock-S）</li>
<li>可以在数据项上获取独占锁（lock-X）</li>
<li>可以将共享锁（lock-S）转换为独占锁（lock-X）（升级）</li>
</ul>
</li>
<li>第二阶段：<ul>
<li>可以释放共享锁（lock-S）（解锁）</li>
<li>可以释放独占锁（lock-X）（解锁）</li>
<li>可以将独占锁（lock-X）转换为共享锁（lock-S）（降级）</li>
</ul>
</li>
</ul>
<h4 id="automatic-acquisition-of-locks">Automatic Acquisition of Locks</h4>
<ul>
<li>read操作
    <code>scss
    if Ti have lock on A:
        read(A)
    else 
        if other don't have lock-X on A:
            grant lock-S on (A)
            read(A)</code></li>
<li>write操作
    <code>scss
    if Ti have lock-X on A:
        write(A)
    else 
        wait until no lock on A:
        if Ti have lock-S on A:
            upgrade to lock-X on A
            write(A)
        else 
            grant lock-X on A
            write(A)</code></li>
</ul>
<h4 id="lock-manager">lock manager</h4>
<ul>
<li>锁管理器可以作为一个独立的进程实现，事务将锁和解锁请求发送给它</li>
<li>锁管理器通过发送锁授权消息来回复锁请求（如果发生死锁，它会发送要求事务回滚的消息）</li>
<li>请求锁的事务会一直等待，直到它的请求得到答复</li>
<li>锁管理器维护一个数据结构，称为锁表，用于记录已授予的锁和待处理的请求</li>
<li>锁表通常作为一个内存中的哈希表实现，索引是被锁定的数据项的名称</li>
</ul>
<p><img alt="alt text" src="../image-172.png" /></p>
<ul>
<li>蓝色表示授予锁，白色表示等待中的请求授予</li>
<li>新的请求会被添加到队尾，只有与前面兼容才会被授予</li>
<li>如果事务回滚，所有该事务的等待或已授予的请求都会被删除</li>
</ul>
<p>example:</p>
<p><img alt="alt text" src="../image-173.png" /></p>
<h4 id="graph-based-protocols">Graph-based protocols</h4>
<ol>
<li>
<p>强加部分排序：
   图形协议要求对数据项集合 <span class="arithmatex">\(D = \{d_1, d_2, ..., d_h\}\)</span> 强加一个部分排序（denoted by <span class="arithmatex">\(\rightarrow\)</span>）。这个部分排序表示数据项之间的访问顺序关系。</p>
</li>
<li>
<p>如果 <span class="arithmatex">\(d_i \rightarrow d_j\)</span>，这意味着任何一个访问 <span class="arithmatex">\(d_i\)</span> 和 <span class="arithmatex">\(d_j\)</span> 的事务，必须先访问 <span class="arithmatex">\(d_i\)</span>，然后再访问 <span class="arithmatex">\(d_j\)</span>。</p>
</li>
<li>
<p>数据库图：
   这种部分排序关系将数据项集合 <span class="arithmatex">\(D\)</span> 视作一个DAG，被称为数据库图（database graph）。</p>
</li>
<li>
<p>在这个图中，图中的每个节点代表一个数据项，而边代表数据项之间的访问顺序。由于是无环图，意味着不会形成循环依赖，避免了死锁的发生。</p>
</li>
</ol>
<p>树协议是图形协议的一种简单形式。树协议要求数据库图中的关系必须形成一个<strong>树结构</strong>。</p>
<p>这是描述<strong>树协议</strong>（<strong>Tree Protocol</strong>）的一些关键规则，树协议作为一种图形协议的简单形式，要求事务对数据项的访问遵循特定的顺序，并且有一定的约束。</p>
<h3 id="_2">详细解释：</h3>
<ol>
<li>
<p>只允许排他锁（Exclusive Locks）：</p>
</li>
<li>
<p>在树协议中，只能使用排他锁，即每次只有一个事务可以访问某个数据项，这样可以避免事务之间的冲突。</p>
</li>
<li>
<p>第一个锁可以在任何数据项上：</p>
</li>
<li>
<p>事务 <span class="arithmatex">\(T_i\)</span> 可以首先在任何数据项上请求并获得排他锁，这个数据项的选择是自由的。</p>
</li>
<li>
<p>之后的数据项锁定要求：</p>
</li>
<li>
<p>在事务 <span class="arithmatex">\(T_i\)</span> 获得一个数据项锁后，接下来它只能请求一个数据项 <span class="arithmatex">\(Q\)</span>，如果且仅如果该数据项的<strong>父数据项</strong>已经由 <span class="arithmatex">\(T_i\)</span> 锁定。</p>
</li>
<li>
<p>换句话说，如果事务 <span class="arithmatex">\(T_i\)</span> 想要访问数据项 <span class="arithmatex">\(Q\)</span>，它必须先访问并锁定 <span class="arithmatex">\(Q\)</span> 的父节点。这种限制可以有效地避免锁定顺序混乱，保证访问顺序的有序性。</p>
</li>
<li>
<p>数据项可以随时解锁：</p>
</li>
<li>
<p>事务 <span class="arithmatex">\(T_i\)</span> 可以在任何时刻解锁它所持有的锁。解锁操作不受严格的时间约束，允许事务灵活地释放资源。</p>
</li>
<li>
<p>一旦解锁后不能重新锁定：</p>
</li>
<li>
<p>如果事务 <span class="arithmatex">\(T_i\)</span> 已经对某个数据项进行了锁定和解锁操作，那么之后它<strong>不能</strong>再次对该数据项进行锁定。</p>
</li>
<li>这意味着，数据项在被解锁后，它不会再被同一个事务再次锁定，避免了某些不必要的锁操作，也减少了死锁的可能性。</li>
</ol>
<p><img alt="alt text" src="../image-174.png" /></p>
<p>树协议的优点主要在于保证了冲突可串行化和免死锁，且事务可以更早解锁数据项，从而提高了并发性。但缺点则集中在其不能保证可恢复性和级联自由，且可能带来额外的锁定开销和减少并发性。</p>
<h3 id="timestamp-based-protocols">*Timestamp-Based Protocols</h3>
<h3 id="validation-based-protocols">*Validation-Based Protocols</h3>
<h3 id="multiple-granularity">Multiple Granularity</h3>
<ul>
<li>粗粒度代表高层，如数据库、表</li>
<li>细粒度代表底层，如行、列</li>
</ul>
<p>当一个事务锁定了粗粒度的节点，其也隐式地锁定了其下方粒度相对小的子节点，且模式一致。</p>
<p><img alt="alt text" src="../image-175.png" /></p>
<p>Problem: T1 locked ra1 in X-lock, T2 locked Fb in S-lock. Now T3 wishes to lock Fa in S-lock. T4  wishes to lock the entire DB in S-lock. (search the entire tree!) </p>
<p>引入意图锁的概念，一个节点被锁定的时候，会在其所有祖先节点加上意图锁，表示其希望锁定该节点及其所有资源(子节点)，用于表示事务计划在较低层级的某些数据项上进行显式的锁定，而不必逐一检查每个子节点。</p>
<ul>
<li>IS：子节点显式存在S-lock节点</li>
<li>IX：子节点显式存在X-lock节点</li>
<li>SIX: S + IX：子节点显式全为S-lock节点，同时更低的后代存在X-lock节点</li>
</ul>
<p><img alt="alt text" src="../image-177.png" /></p>
<p><img alt="alt text" src="../image-176.png" /></p>
<p>多粒度锁定协议（Multiple Granularity Locking, MGL）：</p>
<ol>
<li>
<p>根节点的加锁：</p>
</li>
<li>
<p><strong>根节点</strong>（Tree root）可以在任何锁模式下加锁（<strong>S</strong>, <strong>X</strong>, <strong>IS</strong>, <strong>IX</strong>, <strong>SIX</strong> 等），但加锁必须从根节点开始。</p>
</li>
<li>
<p>子节点的加锁：</p>
</li>
<li>
<p>如果事务 Tₖ 想要加锁节点 Q，必须遵守加锁兼容性矩阵。这意味着 Tₖ 不能以某种锁模式去加锁与当前已经加锁的模式冲突的节点。</p>
</li>
<li>
<p>共享锁 (S) 和意图共享锁 (IS)：</p>
</li>
<li>
<p>事务 Tₖ 可以在<strong>父节点</strong>已被 Tₖ 锁定为 <strong>IX</strong>（意图排他锁）或 <strong>IS</strong>（意图共享锁）模式下，再锁定节点 Q 为 <strong>S</strong>（共享锁）或 <strong>IS</strong>（意图共享锁）模式。</p>
</li>
<li>
<p>排他锁 (X), 共享排它型意向锁 (SIX), 意图排他锁 (IX)：</p>
</li>
<li>
<p>事务 Tₖ 只有在<strong>父节点</strong>已被 Tₖ 锁定为 <strong>IX</strong> 或 <strong>SIX</strong> 模式时，才可以锁定节点 Q 为 <strong>X</strong>（排他锁）、<strong>SIX</strong>（共享排它型意向锁）或 <strong>IX</strong>（意图排他锁）模式。</p>
</li>
<li>
<p>事务的两阶段锁定协议：</p>
</li>
<li>
<p>事务 Ti 必须遵循两阶段锁定协议（2PL）：即它必须首先获取所有需要的锁（加锁阶段），然后在释放锁时不能再获取新的锁（解锁阶段）。换句话说，事务 Ti 在释放锁之前不能再请求新的锁。</p>
</li>
<li>
<p>解锁规则：</p>
</li>
<li>
<p>事务 Ti 只有在<strong>子节点未被锁定</strong>的情况下才能解锁节点 Q。也就是说，解锁操作只能发生在叶节点，解锁顺序是<strong>自下而上</strong>的（即先解锁子节点，再解锁父节点）。</p>
</li>
<li>
<p>加锁和解锁顺序：</p>
</li>
<li>
<p><strong>加锁顺序</strong>是<strong>自顶向下</strong>（从根节点开始，逐步往下锁定子节点）。</p>
</li>
<li><strong>解锁顺序</strong>是<strong>自下而上</strong>（从叶节点开始，逐步向上解锁父节点）。</li>
</ol>
<h3 id="multiversion-schemes">*Multiversion Schemes</h3>
<h3 id="deadlock-handling">Deadlock Handling</h3>
<h4 id="deadlock-prevention">Deadlock Prevention</h4>
<ol>
<li>预声明锁定策略：事务在开始之前就声明并锁定自己需要锁定的数据项，在开始执行后将无法再获取其他锁。很明显的并发性差且难以预测(有些事务不能明确确定其需要的数据项)</li>
<li>数据项部分排序策略（Partial Ordering of Data Items）– 基于图的协议：即对于那些有依赖关系的数据项，施加部分排序，强制其锁定顺序，这样做不会出现循环，自然也不会出现deadlock</li>
<li>wait-die策略与wound-wait策略<ul>
<li>wait-die策略：<ul>
<li>较老的事务请求锁，而该锁已被较为年轻的事务持有，则较老的事务wait</li>
<li>较老的事务持有锁，较年轻的事务请求，则较年轻的事务die(回滚重新执行)</li>
</ul>
</li>
<li>wound-wait策略<ul>
<li>较老的事务请求锁，而该锁已被较为年轻的事务持有，则较老的事务wound较年轻的事务，即将其回滚重新执行</li>
<li>较老的事务持有锁，较年轻的事务请求，则较年轻的事务wait</li>
</ul>
</li>
<li>都是较老的事务优先</li>
<li>不导致死锁</li>
</ul>
</li>
<li>超时策略：等一会你不给我，我直接回滚。可能导致该事务"饥饿"(一直回滚，没有执行的机会)</li>
</ol>
<h4 id="deadlock-detection">Deadlock Detection</h4>
<p>等待图：一个有向图，<span class="arithmatex">\(T_i\)</span>向<span class="arithmatex">\(T_j\)</span>有边当且仅当<span class="arithmatex">\(T_i\)</span>等待<span class="arithmatex">\(T_j\)</span>释放数据项。</p>
<p>死锁发生的条件：显而易见的，存在环。</p>
<p>检测到死锁，我们需要解决，方法是：</p>
<ul>
<li>以最小的代价，回滚部分事务(make a victim)</li>
<li>回滚程度<ul>
<li>全部回滚：完全中止事务并重新开始。事务的所有已执行操作都会被撤销</li>
<li>部分回滚：只回滚事务到一定的状态，而不是完全回滚到开始执行时。事务会恢复到一个较早的检查点，直到达到死锁解除的需求</li>
</ul>
</li>
<li>如果一个事务一直是victim，那么它就是饥饿的</li>
</ul>
<h3 id="insert-and-delete-operations">Insert and Delete Operations</h3>
<p>如果使用二阶段锁定（Two-Phase Locking，2PL）：</p>
<ul>
<li>删除操作只有在删除元组的事务对待删除的元组拥有lock-X时才能执行。</li>
<li>向数据库插入新元组的事务会对该元组获得lock-X</li>
</ul>
<p>插入和删除可能导致幻读现象（Phantom Phenomenon）。执行扫描操作的事务（例如，计算Perryridge所有账户余额的总和）和插入元组的事务（例如，在Perryridge插入一个新账户），在概念上会发生冲突，尽管它们没有访问共同的元组。</p>
<p>如果仅使用元组锁，可能会导致不可串行化的调度。</p>
<p>执行扫描操作的事务正在读取表示关系中包含哪些元组的信息，而插入元组的事务会更新相同的信息。这些信息应该被加锁。</p>
<p>一种解决方案：</p>
<ul>
<li>将一个数据项与关系关联，表示关于该关系包含哪些元组的信息。</li>
<li>执行扫描操作的事务在该数据项上获取S-lock</li>
<li>执行插入或删除操作的事务在该数据项上获取X-lock（注意：数据项上的锁与单个元组上的锁不会冲突。）</li>
</ul>
<p><strong>索引锁定协议</strong>通过要求对某些索引桶加锁，提供了更高的并发性，并防止幻读现象的发生。</p>
<h4 id="index-locking-protocol">Index Locking Protocol</h4>
<ul>
<li>每个关系必须至少有一个索引。对关系的访问必须仅通过该关系上的某个索引进行</li>
<li>一个执行查找操作的事务 <span class="arithmatex">\(T_i\)</span> 必须对其访问的所有索引桶加锁，且加锁模式为S-lock</li>
<li>事务 <span class="arithmatex">\(T_i\)</span> 在向关系 <span class="arithmatex">\(r\)</span> 插入元组 <span class="arithmatex">\(t_i\)</span> 时，必须更新关系 <span class="arithmatex">\(r\)</span> 上的所有索引</li>
<li><span class="arithmatex">\(T_i\)</span> 必须对每个索引执行查找操作，以查找所有可能包含指向元组 <span class="arithmatex">\(t_i\)</span> 的指针的索引桶（假设 <span class="arithmatex">\(t_i\)</span> 已经存在），并对所有这些索引桶加锁，锁模式为X-lock</li>
<li><span class="arithmatex">\(T_i\)</span> 还必须对其修改的所有索引桶获取X-
lock</li>
<li>必须遵循二阶段锁定协议的规则</li>
</ul>
<h3 id="concurrency-in-index-structures">*Concurrency in Index Structures</h3>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.tabs"], "search": "../../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../../assets/javascripts/bundle.f55a23d4.min.js"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/flowchart/1.17.1/flowchart.min.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/raphael/2.3.0/raphael.min.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.13.6/underscore-min.js"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/@mermaid-js/mermaid-mindmap@9.3.0/dist/diagram-definition.0faef4c2.min.js"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/markdown-it-plantuml@1.4.1/index.min.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/webfont/1.6.28/webfontloader.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.0/es5/tex-mml-chtml.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.0/es5/tex-chtml.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.0/es5/tex-chtml-full.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.0/es5/tex-svg-full.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/contrib/auto-render.min.js"></script>
      
    
  </body>
</html>